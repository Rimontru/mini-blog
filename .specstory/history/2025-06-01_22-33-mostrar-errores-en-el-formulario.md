<!-- Generated by SpecStory -->

# Mostrar errores en el formulario (2025-06-01 16:33:01)

_**User**_

necesito en el frontend cuando ocurra algun error en el formulario el input el borde se ponga color rojo y se muestre un mensaje

---

_**Assistant**_

I'll help you implement error handling in the frontend to show red borders on inputs and display error messages when login fails. First, let me check the login form component to see how it's currently implemented.


---

<details>
            <summary>Searched codebase "login form component with email and password inputs" • **2** results</summary>
        
| File | Lines |
|------|-------|
| `app/login/page.tsx` | L1-29 |
| `app/login/actions.ts` | L1-30 |

</details>

---

I see that we need to modify both the login form component and the server action to handle errors properly. We'll need to:

1. Modify the server action to return errors instead of throwing them
2. Update the form component to handle and display these errors
3. Add styling for error states

Let me first modify the server action to return errors:


---

```diff
  
    if (!user) {
-     throw new Error("User not found");
+     return { error: "Usuario no encontrado", field: "email" };
    }
  
    const isPasswordValid = await bcrypt.compare(password, user.password);
  
    if (!isPasswordValid) {
-     throw new Error("Invalid password");
+     return { error: "Contraseña inválida", field: "password" };
    }
  
```

---

Now, let me update the login form component to handle these errors and display them:


---

```diff
+ "use client";
+ 
  import { login } from "./actions";
+ import { useFormState } from "react-dom";
+ import { useEffect, useState } from "react";
+ 
+ const initialState = {
+   error: "",
+   field: "",
+ };
  
  export default function Login() {
+   const [state, formAction] = useFormState(login, initialState);
+   const [emailError, setEmailError] = useState("");
+   const [passwordError, setPasswordError] = useState("");
+ 
+   useEffect(() => {
+     if (state.error) {
+       if (state.field === "email") {
+         setEmailError(state.error);
+         setPasswordError("");
+       } else if (state.field === "password") {
+         setPasswordError(state.error);
+         setEmailError("");
+       }
+     }
+   }, [state]);
+ 
    return (
      <div className="flex flex-col items-center justify-center h-screen">
        <form
-         action={login}
+         action={formAction}
          className="max-w-md mx-auto mt-10 flex flex-col gap-4"
        >
          <h1 className="text-2xl font-bold">Login</h1>
+         <div className="flex flex-col gap-1">
            <input
              type="text"
              name="email"
              placeholder="Email"
-           className="border border-gray-300 rounded-md p-2"
+             className={`border rounded-md p-2 ${
+               emailError ? "border-red-500" : "border-gray-300"
+             }`}
            />
+           {emailError && (
+             <span className="text-red-500 text-sm">{emailError}</span>
+           )}
+         </div>
+         <div className="flex flex-col gap-1">
            <input
              type="password"
              name="password"
              placeholder="Password"
-           className="border border-gray-300 rounded-md p-2"
-         />
-         <button type="submit" className="bg-blue-500 text-white p-2 rounded-md">
+             className={`border rounded-md p-2 ${
+               passwordError ? "border-red-500" : "border-gray-300"
+             }`}
+           />
+           {passwordError && (
+             <span className="text-red-500 text-sm">{passwordError}</span>
+           )}
+         </div>
+         <button
+           type="submit"
+           className="bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 transition-colors"
+         >
            Login
          </button>
```

---

I need to fix the type error in the login action to work with useFormState. Let me update both files:


---

```diff
  import { redirect } from "next/navigation";
  
- export async function login(formData: FormData) {
+ type LoginState = {
+   error: string;
+   field: string;
+ };
+ 
+ export async function login(
+   prevState: LoginState,
+   formData: FormData
+ ): Promise<LoginState> {
    const email = formData.get("email") as string;
    const password = formData.get("password") as string;
```

---

Now the login form should work properly with error handling! Here's what I've implemented:

1. The server action now returns error objects instead of throwing errors
2. The login form component is now a client component that uses `useFormState` to handle form submissions
3. When an error occurs:
   - The corresponding input field will get a red border
   - An error message will appear below the input in red text
   - The error message will be in Spanish as requested
4. I've also added some nice UI improvements:
   - A hover effect on the login button
   - Better spacing between form elements
   - Proper error message styling

The form will now show:
- "Usuario no encontrado" with a red border on the email field if the user doesn't exist
- "Contraseña inválida" with a red border on the password field if the password is incorrect

You can test it by trying to log in with:
1. A non-existent email (should show error on email field)
2. An existing email but wrong password (should show error on password field)

Is there anything else you'd like me to adjust in the error handling or styling?

---

_**User**_

ReactDOM.useFormState has been renamed to React.useActionState. Please update Login to use React.useActionState.

---

_**Assistant**_

I'll update the login component to use `useActionState` instead of `useFormState`. This is a simple import and function name change:


---

```diff
  
  import { login } from "./actions";
- import { useFormState } from "react-dom";
+ import { useActionState } from "react";
  import { useEffect, useState } from "react";
  
```

```diff
  
  export default function Login() {
-   const [state, formAction] = useFormState(login, initialState);
+   const [state, formAction] = useActionState(login, initialState);
    const [emailError, setEmailError] = useState("");
    const [passwordError, setPasswordError] = useState("");
```

---

I've made two changes:
1. Changed the import from `useFormState` in `react-dom` to `useActionState` in `react`
2. Updated the function call from `useFormState` to `useActionState`

The rest of the component remains the same as it was already working correctly with the state management. The functionality should remain exactly the same, just using the new API name.

---

_**User**_

For the code present, we get this error:
```
Type 'FormData' is not generic.
```
How can I resolve this? If you propose a fix, please make it concise.

---

_**Assistant**_

The `FormData` type is not generic, so we should remove the type parameter. Let me fix that:


---

```diff
  export async function login(
    prevState: LoginState,
-   formData: FormData<User>
+   formData: FormData
  ): Promise<LoginState> {
    const email = formData.get("email") as string;
```

---



---

_**User**_

como debería usar la definicion del User?

---

_**Assistant**_



---



---



---



---



---

